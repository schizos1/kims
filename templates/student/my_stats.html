{% extends "student/layout.html" %}

{% block title %}{{ session.username }}님의 학습 통계{% endblock %}

{% block content %}
    <h2 class="mb-4">{{ session.username }}님의 학습 통계</h2>

    {% if concept_stats %}
    <p class="lead">지금까지 학습한 개념들의 성취도입니다. 정답률이 낮은 개념부터 복습해보세요!</p>
    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">과목</th>
                    <th scope="col">개념</th>
                    <th scope="col">시도 횟수</th>
                    <th scope="col">정답 횟수</th>
                    <th scope="col">정답률</th>
                    <th scope="col">복습/재도전</th>
                </tr>
            </thead>
            <tbody>
                {% for stat in concept_stats %}
                <tr>
                    <th scope="row">{{ loop.index }}</th>
                    <td>{{ stat.subject_name }}</td>
                    <td>{{ stat.concept_name }}</td>
                    <td>{{ stat.total_attempted }}회</td>
                    <td>{{ stat.total_correct }}회</td>
                    <td>
                        <div class="progress" style="height: 25px;" role="progressbar" aria-label="정답률 {{ stat.accuracy }}%" aria-valuenow="{{ stat.accuracy }}" aria-valuemin="0" aria-valuemax="100">
                            <div class="progress-bar {% if stat.accuracy < 50 %}bg-danger{% elif stat.accuracy < 80 %}bg-warning{% else %}bg-success{% endif %}" 
                                 style="width: {{ stat.accuracy }}%;">
                                {{ stat.accuracy }}%
                            </div>
                        </div>
                    </td>
                    <td>
                        <a href="{{ url_for('learn_concept_step', concept_id=stat.concept_id, step_order=1) }}" class="btn btn-sm btn-outline-info mb-1">개념 복습</a>
                        <a href="{{ url_for('start_concept_test', concept_id=stat.concept_id) }}" class="btn btn-sm btn-outline-primary mb-1">테스트 재도전</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info">
        아직 학습 기록이 충분하지 않습니다. 다양한 개념을 학습하고 테스트를 진행해보세요!
    </div>
    {% endif %}

    <div class="mt-4">
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">&laquo; 대시보드로 돌아가기</a>
    </div>
{% endblock %}