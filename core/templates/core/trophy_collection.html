{% extends "base.html" %}
{% load get_item %}
{% block content %}
<div class="container mt-5">
  <h2 class="text-center mb-4">🏆 트로피 보관함</h2>
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">

    {% for trophy in all_trophies %}
      {% with user_trophy=user_trophies_by_id|get_item:trophy.id %}
      <div class="col">
        <div class="card h-100 text-center shadow-sm {% if not user_trophy %}opacity-50{% endif %}">
          <img src="{{ trophy.image_url }}" class="card-img-top mx-auto mt-3" style="width: 80px;" alt="Trophy Icon">
          <div class="card-body">
            <h5 class="card-title">{{ trophy.name }}</h5>
            <p class="card-text">{{ trophy.description }}</p>
            <p><strong>🎯 목표:</strong> {{ trophy.goal_value }}</p>
            {% if trophy.trophy_type == "activity" %}
              <p>📘 총 풀이 수: {{ user_log_count }}</p>
            {% elif trophy.trophy_type == "correct" %}
              <p>✅ 정답 수: {{ user_correct_count }}</p>
            {% elif trophy.trophy_type == "wrong" %}
              <p>🛠 정정된 오답: {{ user_resolved_count }}</p>
            {% endif %}
            {% if not user_trophy %}
              <div class="progress mt-2" style="height: 10px;">
                <div class="progress-bar" role="progressbar"
                  style="width: {{ progress_percent|get_item:trophy.id }}%;"
                  aria-valuenow="{{ progress_percent|get_item:trophy.id }}" aria-valuemin="0" aria-valuemax="100">
                </div>
              </div>
              <small class="text-muted">{{ progress_percent|get_item:trophy.id }}% 달성</small>
            {% else %}
              <p class="text-success mt-2">🏅 획득 완료!</p>
            {% endif %}
          </div>
        </div>
      </div>
      {% endwith %}
    {% endfor %}

  </div>
</div>
{% endblock %}
