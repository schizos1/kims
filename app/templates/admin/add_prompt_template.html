{% extends "admin/layout.html" %}

{% block content %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('admin.manage_prompt_templates') }}">프롬프트 템플릿 관리</a></li>
        <li class="breadcrumb-item active" aria-current="page">새 프롬프트 템플릿 추가</li>
    </ol>
</nav>

<h2 class="mb-4">새 프롬프트 템플릿 추가</h2>

<form method="POST" action="{{ url_for('admin.add_prompt_template') }}">
    <div class="card">
        <div class="card-body">
            <div class="mb-3">
                <label for="name" class="form-label"><strong>템플릿 이름 <span class="text-danger">*</span></strong></label>
                <input type="text" class="form-control" id="name" name="name" value="{{ form_data.name or '' }}" required placeholder="예: 초등 수학 객관식 기본">
            </div>

            <div class="mb-3">
                <label for="subject_id" class="form-label">연결 과목 (선택 사항)</label>
                <select class="form-select" id="subject_id" name="subject_id">
                    <option value="">-- 공용 템플릿 --</option>
                    {% for subject in subjects %}
                    {# --- ★★★ 이 부분이 수정되었습니다 ★★★ --- #}
                    <option value="{{ subject.id }}" {% if form_data.get('subject_id')|int == subject.id %}selected{% endif %}>{{ subject.name }}</option>
                    {# ------------------------------------ #}
                    {% endfor %}
                </select>
                <small class="form-text text-muted">이 템플릿을 특정 과목 전용으로 지정할 수 있습니다.</small>
            </div>

            <div class="mb-3">
                <label for="prompt_text" class="form-label"><strong>프롬프트 내용 <span class="text-danger">*</span></strong></label>
                <textarea class="form-control" id="prompt_text" name="prompt_text" rows="15" required placeholder="AI에게 전달할 프롬프트 내용을 입력하세요. {{ subject_name }} 와 {{ concept_name }} 변수를 사용할 수 있습니다.">{{ form_data.prompt_text or '' }}</textarea>
                <small class="form-text text-muted">변수 예시: `{{ '{{ subject_name }}' }}` 과목의 `{{ '{{ concept_name }}' }}` 개념에 대해 설명해주세요.</small>
            </div>

            <div class="mb-3">
                <label for="notes" class="form-label">설명/참고</label>
                <textarea class="form-control" id="notes" name="notes" rows="3">{{ form_data.notes or '' }}</textarea>
                <small class="form-text text-muted">이 프롬프트 템플릿에 대한 설명이나 사용법을 기록합니다.</small>
            </div>
            
            <div class="mb-4 form-check">
                {# --- ★★★ 이 부분도 form_data.get() 사용으로 수정 ★★★ --- #}
                <input type="checkbox" class="form-check-input" id="is_default_for_subject" name="is_default_for_subject" {% if form_data.get('is_default_for_subject') == 'on' %}checked{% endif %}>
                <label class="form-check-label" for="is_default_for_subject">이 템플릿을 위에서 선택한 과목의 기본 프롬프트로 사용</label>
                <small class="form-text text-muted d-block"> (체크 시, 해당 과목에 다른 기본 프롬프트가 있다면 이 템플릿으로 대체됩니다. 과목을 선택하지 않으면 이 옵션은 무시됩니다.)</small>
            </div>

            <div class="d-flex justify-content-end">
                <a href="{{ url_for('admin.manage_prompt_templates') }}" class="btn btn-secondary me-2">취소</a>
                <button type="submit" class="btn btn-primary">새 템플릿 저장</button>
            </div>
        </div>
    </div>
</form>
{% endblock %}