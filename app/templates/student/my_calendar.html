{% extends "student/layout.html" %}

{% block title %}{{ session.username }}님의 학습 캘린더{% endblock %}

{% block head_extra %}
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css' rel='stylesheet' />
    <style>
        #calendar {
            max-width: 900px;
            margin: 20px auto;
            padding: 15px; /* 패딩 증가 */
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1); /* 그림자 개선 */
        }
        /* FullCalendar 이벤트 기본 스타일 */
        .fc-event {
            background-color: #0d6efd !important; /* Bootstrap primary color */
            border-color: #0d6efd !important;
            color: white !important;
            cursor: pointer;
            padding: 2px 4px; /* 이벤트 내부 패딩 */
            font-size: 0.85em; /* 이벤트 폰트 크기 */
        }
        .fc-event:hover {
            background-color: #0b5ed7 !important; /* 호버 시 약간 어둡게 */
        }
        .fc-daygrid-day-number {
            font-weight: bold;
            padding: 5px; /* 날짜 숫자 주변 패딩 */
        }
        .fc-toolbar-title {
            font-size: 1.5rem; /* 달력 제목 크기 */
        }
        /* 오늘 날짜 배경색 */
        .fc-day-today { 
            background-color: #eaf6ff !important;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-calendar-alt me-2"></i>{{ session.username }}님의 학습 캘린더</h2>
        <a href="{{ url_for('student.dashboard') }}" class="btn btn-outline-secondary">&laquo; 대시보드로 돌아가기</a>
    </div>
    
    <p class="text-muted">달력에 학습 활동이 기록된 날짜가 표시됩니다. 날짜의 이벤트를 클릭하면 해당 날의 활동 횟수를 볼 수 있습니다.</p>

    <div id='calendar'></div>

{% endblock %}

{% block scripts_extra %}
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            if (calendarEl) { // calendarEl이 존재하는지 확인
                var calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek' // 주간 보기 옵션도 추가
                    },
                    locale: 'ko', // 한국어 설정
                    events: '/get-calendar-events', // 서버에서 이벤트 데이터를 가져올 URL
                    eventDisplay: 'block', // 이벤트를 블록 형태로 표시
                    
                    eventClick: function(info) {
                        // 이벤트를 클릭했을 때
                        alert(info.event.start.toLocaleDateString() + ' 학습 활동: ' + info.event.title);
                        // 향후 모달창 등으로 더 자세한 정보 표시 가능
                    },
                    dateClick: function(info) {
                        // 날짜 자체를 클릭했을 때 (이벤트가 없는 날도 포함)
                        // console.log('Date clicked: ' + info.dateStr);
                        // 필요하다면 이 기능도 활용 가능
                    },
                    dayCellDidMount: function(info) {
                        // 오늘 날짜 강조 (FullCalendar v6의 today selector가 더 안정적일 수 있음)
                        // if (info.isToday) {
                        //     info.el.style.backgroundColor = '#eaf6ff';
                        // }
                        // FullCalendar 자체 today 스타일 사용 권장
                    },
                    loading: function(isLoading) {
                        // 로딩 중일 때 스피너 등을 표시하거나 숨기는 로직 (선택 사항)
                        if (isLoading) {
                            // console.log('Calendar is loading events...');
                        } else {
                            // console.log('Events have finished loading!');
                        }
                    },
                    eventTimeFormat: { // 이벤트 시간 표시 안함 (종일 이벤트이므로)
                        hour: 'numeric',
                        minute: '2-digit',
                        omitZeroMinute: true,
                        meridiem: 'short'
                    },
                    displayEventEnd: false // 종일 이벤트의 종료 시간 표시 안함
                });
                calendar.render();
            } else {
                console.error("Calendar element not found!");
            }
        });
    </script>
{% endblock %}