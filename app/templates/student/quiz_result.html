{% extends "student/layout.html" %}

{% block title %}{{ concept.name }} 채점 결과{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4 text-center text-primary"><i class="fas fa-check-circle me-2"></i>{{ concept.name }} 채점 결과</h2>

  <div class="row justify-content-center mb-4">
    <div class="col-md-6">
      <div class="card text-center shadow">
        <div class="card-body">
          <h5 class="card-title">총 {{ total }}문제 중</h5>
          <h2 class="text-success">{{ correct }}개 정답 🎉</h2>
          <p class="text-muted">정확한 실력을 쌓아가고 있어요!</p>
        </div>
      </div>
    </div>
  </div>

  {% for item in results %}
    <div class="card mb-4 shadow-sm">
      <div class="card-header d-flex justify-content-between align-items-center">
        <strong>문제 {{ loop.index }}</strong>
        {% if item.is_correct %}
          <span class="badge bg-success">정답</span>
        {% else %}
          <span class="badge bg-danger">오답</span>
        {% endif %}
      </div>
      <div class="card-body">
        <p>{{ item.question.content }}</p>
        {% if item.question.image_filename %}
          <img src="{{ url_for('static', filename='images/questions/' ~ item.question.image_filename) }}"
               class="img-fluid rounded mb-3 border" alt="문제 이미지">
        {% endif %}

        {% set options = [item.question.option1, item.question.option2, item.question.option3, item.question.option4] %}
        <ul class="list-group">
          {% for opt in options %}
            {% set index = loop.index %}
            <li class="list-group-item d-flex justify-content-between align-items-center
                {% if item.user_answer == index|string %}list-group-item-warning{% endif %}
                {% if item.question.answer == index|string %}list-group-item-success fw-bold{% endif %}">
              {{ ['①','②','③','④'][loop.index0] }} {{ opt }}
              {% if item.question.answer == index|string %}
                <span class="badge bg-success">정답</span>
              {% elif item.user_answer == index|string %}
                <span class="badge bg-warning text-dark">선택</span>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  {% endfor %}

  <div class="text-center mt-4">
    <a href="{{ url_for('student.dashboard') }}" class="btn btn-outline-primary">대시보드로 돌아가기</a>
    <a href="{{ url_for('student.my_mistake_notebook') }}" class="btn btn-outline-warning">오답노트 보기</a>
  </div>
</div>
{% endblock %}
