{% extends "student/layout.html" %}

{% block title %}{{ concept.name }} - 테스트{% endblock %}

{% block head_extra %}
<style>
    .question-content {
        white-space: pre-wrap;
        line-height: 1.8;
        margin-bottom: 1rem;
    }
    .options-group .form-check {
        margin-bottom: 0.75rem;
        padding: 0.5rem 1rem;
        border: 1px solid #eee;
        border-radius: 0.375rem;
        transition: background-color 0.2s ease-in-out;
    }
    .options-group .form-check:hover {
        background-color: #f8f9fa;
    }
    .options-group .form-check-input {
        margin-top: 0.4em;
    }
    .options-group .form-check-label {
        width: 100%;
    }
</style>
{% endblock %}

{% block content %}
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('student.dashboard') }}">과목 목록</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('student.view_subject_concepts', subject_id=concept.subject.id) }}">{{ concept.subject.name }}</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ concept.name }} - 테스트</li>
        </ol>
    </nav>

    <h2 class="mb-4">'{{ concept.name }}' 개념 확인 테스트</h2>
    <hr>

    {% if questions %}
        <form action="{{ url_for('student.start_concept_test', concept_id=concept.id) }}" method="POST">
            {% for question in questions %}
            <div class="card mb-4">
                <div class="card-header">
                    <strong>문제 {{ loop.index }}</strong>
                </div>
                <div class="card-body">
                    <div class="question-content">{{ question.content }}</div>
                    
                    {# 객관식 문제 보기 표시 #}
                    {% if question.question_type == 'multiple_choice' and question.option1 %}
                        <div class="options-group mt-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="answer_{{ question.id }}" id="q{{ question.id }}_opt1" value="1" required>
                                <label class="form-check-label" for="q{{ question.id }}_opt1">
                                    <strong class="me-2">1.</strong> {{ question.option1 }}
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="answer_{{ question.id }}" id="q{{ question.id }}_opt2" value="2" required>
                                <label class="form-check-label" for="q{{ question.id }}_opt2">
                                    <strong class="me-2">2.</strong> {{ question.option2 }}
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="answer_{{ question.id }}" id="q{{ question.id }}_opt3" value="3" required>
                                <label class="form-check-label" for="q{{ question.id }}_opt3">
                                    <strong class="me-2">3.</strong> {{ question.option3 }}
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="answer_{{ question.id }}" id="q{{ question.id }}_opt4" value="4" required>
                                <label class="form-check-label" for="q{{ question.id }}_opt4">
                                    <strong class="me-2">4.</strong> {{ question.option4 }}
                                </label>
                            </div>
                        </div>
                    {% else %} {# 주관식 단답형의 경우 (또는 보기가 없는 경우) #}
                        <div class="mb-3 mt-3">
                            <label for="answer_{{ question.id }}" class="form-label visually-hidden">정답 입력</label>
                            <input type="text" class="form-control" id="answer_{{ question.id }}" name="answer_{{ question.id }}" placeholder="여기에 정답을 입력하세요" required>
                        </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
            <div class="d-grid gap-2 mt-4">
                <button type="submit" class="btn btn-success btn-lg">답안 제출하기</button>
            </div>
        </form>
    {% else %}
        <div class="alert alert-warning">
            테스트할 문제가 없습니다. 관리자에게 문의하세요.
        </div>
    {% endif %}
{% endblock %}