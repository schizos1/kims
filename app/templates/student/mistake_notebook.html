{% extends "student/layout.html" %}

{% block title %}나의 오답 노트{% endblock %}

{% block head_extra %}
<style>
    .concept-group {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: .75rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 .125rem .25rem rgba(0,0,0,.075);
    }
    .concept-header {
        border-bottom: 1px solid #ced4da;
        padding-bottom: 0.75rem;
        margin-bottom: 1rem;
    }
    .question-sample {
        font-size: 0.9em;
        color: #6c757d;
        padding-left: 1.5rem;
        border-left: 3px solid #0d6efd;
        margin-top: 0.5rem;
    }
    .question-sample p {
        margin-bottom: 0.25rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .clear-btn {
        display: inline-block;
        margin-top: 0.25rem;
    }
</style>
{% endblock %}

{% block content %}
<h2 class="mb-4"><i class="fas fa-book-reader me-2"></i>나의 오답 노트</h2>

<p class="lead mb-4">틀렸던 문제들을 개념별로 다시 학습하고 풀어보세요. 맞힌 문제는 오답 노트에서 제외됩니다.</p>

{% if grouped_mistakes %}
    {% for group in grouped_mistakes %}
    <div class="concept-group">
        <div class="concept-header d-flex justify-content-between align-items-center">
            <div>
                <h4 class="mb-1">{{ group.concept_name }} <span class="badge bg-secondary">{{ group.subject_name }}</span></h4>
                <small class="text-muted">틀린 문제: {{ group.question_count }}개</small>
            </div>
            <a href="{{ url_for('student.reattempt_mistakes_by_concept', concept_id=group.concept_id) }}" class="btn btn-warning">
                <i class="fas fa-redo me-1"></i> 이 개념 오답 모아 풀기
            </a>
        </div>
        
        {% if group.questions_sample %}
        <div class="question-sample">
            <small><strong>최근 틀린 문제 예시:</strong></small>
            {% for q_sample in group.questions_sample %}
                <div class="d-flex justify-content-between align-items-center mb-1">
                    <p class="mb-0 me-2">{{ q_sample.content }}</p>
                    <form method="POST" action="{{ url_for('student.clear_mistake', question_id=q_sample.id) }}" class="clear-btn">
                        <button type="submit" class="btn btn-sm btn-outline-success">복습 완료</button>
                    </form>
                </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endfor %}
{% else %}
    <div class="alert alert-success text-center shadow-sm">
        <h4 class="alert-heading mt-2"><i class="fas fa-check-circle fa-2x mb-2"></i><br>축하합니다!</h4>
        <p class="mb-0">현재 오답 노트에 기록된 문제가 없습니다. 모든 문제를 완벽하게 이해하셨네요!</p>
    </div>
{% endif %}

<div class="mt-4">
    <a href="{{ url_for('student.dashboard') }}" class="btn btn-secondary">&laquo; 대시보드로 돌아가기</a>
</div>
{% endblock %}
