{# templates/student/my_page.html #}
{% extends "student/layout.html" %}

{% block title %}{{ user.username }}λ‹μ λ§μ΄ νμ΄μ§€{% endblock %}

{% block head_extra %}
<style>
    .trophy-icon { font-size: 3rem; color: #ffc107; margin-bottom: 0.5rem; }
    .points-badge { font-size: 0.8em; }
    .card-title { margin-bottom: 0.25rem; }
    .theme-selector .btn { margin: 5px; }
    .current-mascot-display {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #ddd;
        margin-bottom: 10px;
    }
    .mascot-option img {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 10px;
        border: 2px solid transparent;
        cursor: pointer;
        transition: border-color 0.3s ease;
    }
    .mascot-option img:hover, .mascot-option input[type="radio"]:checked + img {
        border-color: #007bff;
        box-shadow: 0 0 8px rgba(0,123,255,0.5);
    }
    .mascot-option input[type="radio"] {
        display: none;
    }
</style>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-4">
            {# β…β…β… μ£Όμ„ μ κ±° λλ” Jinja2 μ£Όμ„μΌλ΅ λ³€κ²½ β…β…β… #}
            <div class="card mb-4">
                <div class="card-header text-center">
                    <h4>λ‚΄ μ •λ³΄</h4>
                </div>
                <div class="card-body text-center">
                    {% if user.selected_mascot_filename %}
                        <img src="{{ url_for('static', filename='images/mascots/' + user.selected_mascot_filename) }}" alt="μ„ νƒλ λ§μ¤μ½”νΈ" class="current-mascot-display img-thumbnail">
                    {% else %}
                        <div class="current-mascot-display bg-light d-flex align-items-center justify-content-center text-muted">
                            <small>λ§μ¤μ½”νΈ<br>μ„ νƒ μ• ν•¨</small>
                        </div>
                    {% endif %}
                    <p><strong>μ•„μ΄λ””:</strong> {{ user.username }}</p>
                    <p><strong>μ—­ν• :</strong> {{ user.role }}</p>
                    <p><strong>μ΄ νλ“ ν¬μΈνΈ:</strong> <span class="badge bg-success fs-5">{{ user.total_earned_points }} P</span></p>
                </div>
            </div>

            {# ... (λ‚λ¨Έμ§€ ν¬μΈνΈ μ‚¬μ© νΌ, ν…λ§ λ³€κ²½ UI, λ§μ¤μ½”νΈ λ³€κ²½ UI λ“±μ€ μ΄μ „κ³Ό λ™μΌν•κ² μ μ§€) ... #}
            <div class="card mb-4">
                <div class="card-header">
                    <h4>ν¬μΈνΈ μ‚¬μ©ν•κΈ° π’°</h4>
                </div>
                <div class="card-body">
                    <p>ν„μ¬ μ‚¬μ© κ°€λ¥ ν¬μΈνΈ: <strong class="fs-5 text-primary">{{ user.total_earned_points }} P</strong></p>
                    <form action="{{ url_for('student.use_points') }}" method="POST" class="row g-3 align-items-end">
                        <div class="col-sm-7">
                            <label for="points_to_use" class="form-label">μ‚¬μ©ν•  ν¬μΈνΈ</label>
                            <input type="number" class="form-control" id="points_to_use" name="points_to_use" min="1" placeholder="μ: 1000" required>
                        </div>
                        <div class="col-sm-5">
                            <button type="submit" class="btn btn-warning w-100">ν¬μΈνΈ μ‚¬μ© μ”μ²­</button>
                        </div>
                    </form>
                    <small class="form-text text-muted d-block mt-2">
                        (μ°Έκ³ : μ‚¬μ©λ ν¬μΈνΈλ” κ΄€λ¦¬μμ™€μ μ•½μ†μ— λ”°λΌ μ‹¤μ  μ©λ λ“±μΌλ΅ κµν™λ  μ μμµλ‹λ‹¤.)
                    </small>
                </div>
            </div>

            <div class="card mb-4 theme-selector">
                <div class="card-header">
                    <h4>π¨ ν…λ§ λ³€κ²½</h4>
                </div>
                <div class="card-body text-center">
                    <p><small>ν•™μµ ν™κ²½μ λ¶„μ„κΈ°λ¥Ό λ°”κΏ”λ³΄μ„Έμ”!</small></p>
                    <div class="btn-group" role="group" aria-label="Theme selection">
                        <a href="{{ url_for('student.set_theme', theme_name='theme-light-blue') }}" class="btn btn-outline-primary {% if session.get('user_theme', 'theme-light-blue') == 'theme-light-blue' %}active{% endif %}">κΈ°λ³Έ ν•λ</a>
                        <a href="{{ url_for('student.set_theme', theme_name='theme-fresh-green') }}" class="btn btn-outline-success {% if session.get('user_theme') == 'theme-fresh-green' %}active{% endif %}">μƒνΌ μ΄λ΅</a>
                        <a href="{{ url_for('student.set_theme', theme_name='theme-warm-orange') }}" class="btn btn-outline-warning {% if session.get('user_theme') == 'theme-warm-orange' %}active{% endif %}">λ”°λ» μ£Όν™©</a>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <h4><i class="fas fa-paw me-2"></i>λ§μ¤μ½”νΈ λ³€κ²½</h4>
                </div>
                <div class="card-body">
                    <p><small>λ‚λ¥Ό λ€ν‘ν•  λ§μ¤μ½”νΈλ¥Ό μ„ νƒν•΄μ£Όμ„Έμ”!</small></p>
                    <form action="{{ url_for('student.set_mascot') }}" method="POST">
                        <div class="mb-3 d-flex flex-wrap justify-content-center">
                            {% for mascot_file in available_mascots %}
                                <label class="mascot-option m-2">
                                    <input type="radio" name="mascot_filename" value="{{ mascot_file }}" {% if user.selected_mascot_filename == mascot_file %}checked{% endif %} required>
                                    <img src="{{ url_for('static', filename='images/mascots/' + mascot_file) }}" alt="{{ mascot_file.split('.')[0] }}" class="img-thumbnail">
                                </label>
                            {% else %}
                                <p>μ„ νƒ κ°€λ¥ν• λ§μ¤μ½”νΈκ°€ μ—†μµλ‹λ‹¤. κ΄€λ¦¬μμ—κ² λ¬Έμν•μ„Έμ”.</p>
                            {% endfor %}
                        </div>
                        {% if available_mascots %}
                        <div class="d-grid">
                            <button type="submit" class="btn btn-info">λ§μ¤μ½”νΈ μ €μ¥</button>
                        </div>
                        {% endif %}
                    </form>
                </div>
            </div>

        </div>
        <div class="col-md-8">
            <div class="card">
                <div class="card-header"><h4>λ‚΄κ°€ νλ“ν• νΈλ΅ν”Ό π†</h4></div>
                <div class="card-body">
                    {% if earned_user_trophies %}
                        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
                            {% for user_trophy in earned_user_trophies %}
                            <div class="col">
                                <div class="card h-100 text-center">
                                    <div class="card-body d-flex flex-column justify-content-center align-items-center">
                                        <div class="my-2"><i class="{{ user_trophy.trophy.icon_class }} trophy-icon"></i></div>
                                        <h5 class="card-title">{{ user_trophy.trophy.name }}</h5>
                                        <span class="badge rounded-pill bg-warning text-dark points-badge mb-2">{{ user_trophy.trophy.points }} P</span>
                                        <p class="card-text"><small>{{ user_trophy.trophy.description }}</small></p>
                                    </div>
                                    <div class="card-footer"><small class="text-muted">νλ“: {{ user_trophy.earned_at.strftime('%Yλ…„ %mμ›” %dμΌ') }}</small></div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p>μ•„μ§ νλ“ν• νΈλ΅ν”Όκ°€ μ—†μµλ‹λ‹¤. μ—΄μ‹¬ν ν•™μµν•΄μ„ νΈλ΅ν”Όλ¥Ό λ¨μ•„λ³΄μ„Έμ”!</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}