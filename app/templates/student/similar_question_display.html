{% extends "student/layout.html" %}

{% block title %}ìœ ì‚¬ ë¬¸ì œ ì—°ìŠµ - {{ original_question.concept.name }}{% endblock %}

{% block head_extra %}
<style>
    /* ... (ê¸°ì¡´ question-box, answer-box ë“± ìŠ¤íƒ€ì¼ ìœ ì§€) ... */
    .question-box { white-space: pre-wrap; line-height: 1.7; background-color: #f8f9fa; padding: 15px; border-radius: 5px; border: 1px solid #dee2e6; }
    .answer-box { padding: 10px; border-radius: 5px; }
    .correct-answer-display { background-color: #d1e7dd; border-color: #badbcc; }
    .user-answer-correct { background-color: #d1e7dd; border-color: #badbcc; }
    .user-answer-incorrect { background-color: #f8d7da; border-color: #f5c2c7; }

    /* â˜…â˜…â˜… ì •ë‹µ/ì˜¤ë‹µ ì• ë‹ˆë©”ì´ì…˜ CSS ì¶”ê°€ â˜…â˜…â˜… */
    @keyframes sparkle { /* ì •ë‹µ ì‹œ ë°˜ì§ì´ëŠ” íš¨ê³¼ */
        0% { box-shadow: 0 0 5px #28a745; transform: scale(1); }
        50% { box-shadow: 0 0 20px #28a745, 0 0 30px #28a745; transform: scale(1.05); }
        100% { box-shadow: 0 0 5px #28a745; transform: scale(1); }
    }
    @keyframes shake { /* ì˜¤ë‹µ ì‹œ í”ë“¤ë¦¬ëŠ” íš¨ê³¼ */
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
        20%, 40%, 60%, 80% { transform: translateX(8px); }
    }
    .feedback-correct-animation {
        animation: sparkle 0.8s ease-in-out;
    }
    .feedback-incorrect-animation {
        animation: shake 0.5s ease-in-out;
    }
</style>
{% endblock %}

{% block content %}
    {# ... (ê¸°ì¡´ navbar ë° breadcrumb, ì›ë˜ ë¬¸ì œ í‘œì‹œ ë¶€ë¶„ ë“±) ... #}
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">ê³¼ëª© ëª©ë¡</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('view_subject_concepts', subject_id=original_question.concept.subject.id) }}">{{ original_question.concept.subject.name }}</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('start_concept_test', concept_id=original_question.concept.id) }}">{{ original_question.concept.name }} í…ŒìŠ¤íŠ¸</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('view_test_results', concept_id=original_question.concept.id) }}">ê²°ê³¼</a></li>
            <li class="breadcrumb-item active" aria-current="page">ìœ ì‚¬ ë¬¸ì œ</li>
        </ol>
    </nav>

    <h2 class="mb-3">'{{ original_question.concept.name }}' ê°œë… - ìœ ì‚¬ ë¬¸ì œ ì—°ìŠµ</h2>

    <div class="card mb-4">
        <div class="card-header"><strong>ì›ë˜ ë¬¸ì œ (ì°¸ê³ ìš©)</strong></div>
        <div class="card-body">
            <div class="question-box">{{ original_question.content }}</div>
            <p class="mt-2"><strong>ì›ë˜ ì •ë‹µ:</strong> {{ original_question.answer }}</p>
        </div>
    </div>

    <div class="card border-primary">
        <div class="card-header bg-primary text-white"><strong>âœ¨ AIê°€ ìƒì„±í•œ ìƒˆë¡œìš´ ìœ ì‚¬ ë¬¸ì œ âœ¨</strong></div>
        <div class="card-body">
            <div class="question-box fs-5 mb-3">{{ new_question_text }}</div>

            {% if feedback_result %}
                <script>
                    document.addEventListener('DOMContentLoaded', function() { 
                        if (typeof playSound === "function") { 
                            {% if feedback_result.is_correct %}
                                playSound('correct.mp3');
                            {% else %}
                                playSound('incorrect.mp3');
                            {% endif %}
                        }
                    });
                </script>

                {# â˜…â˜…â˜… ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ ì¶”ê°€ â˜…â˜…â˜… #}
                <div class="mb-3 {% if feedback_result.is_correct %}feedback-correct-animation{% else %}feedback-incorrect-animation{% endif %}">
                    <p class="mb-1"><strong>ë‚´ê°€ ì œì¶œí•œ ë‹µ:</strong></p>
                    <div class="answer-box {% if feedback_result.is_correct %}user-answer-correct{% else %}user-answer-incorrect{% endif %}">
                        {{ feedback_result.submitted if feedback_result.submitted else 'ë‹µë³€ ì•ˆ í•¨' }}
                    </div>
                </div>
                {% if feedback_result.is_correct %}
                    <div class="alert alert-success fw-bold">ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤! ì˜í•˜ì…¨ì–´ìš”! ğŸ‰</div>
                {% else %}
                    <div class="alert alert-danger fw-bold">ğŸ˜Ÿ ì•„ì‰½ì§€ë§Œ í‹€ë ¸ì–´ìš”.</div>
                    <p class="mb-1"><strong>ì •ë‹µ:</strong></p>
                    <div class="answer-box correct-answer-display">{{ feedback_result.correct }}</div>
                {% endif %}
                <hr>
                <a href="{{ url_for('generate_similar_question_page', original_question_id=original_question.id) }}" class="btn btn-warning mt-2">ğŸ”„ ë‹¤ë¥¸ ìœ ì‚¬ ë¬¸ì œ í’€ì–´ë³´ê¸°</a>

            {% else %}
                <form action="{{ url_for('generate_similar_question_page', original_question_id=original_question.id) }}" method="POST">
                    <div class="mb-3">
                        <label for="submitted_answer" class="form-label"><strong>ì •ë‹µ ì…ë ¥:</strong></label>
                        <input type="text" class="form-control" id="submitted_answer" name="submitted_answer" required>
                    </div>
                    <button type="submit" class="btn btn-success">ë‹µë³€ ì œì¶œ</button>
                </form>
            {% endif %}
        </div>
    </div>

    <div class="mt-4">
        <a href="{{ url_for('view_test_results', concept_id=original_question.concept.id) }}" class="btn btn-secondary">&laquo; í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
{% endblock %}

{% block scripts_extra %}
{# ì´ í˜ì´ì§€ëŠ” layout.htmlì˜ playSound í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ, ë³„ë„ ìŠ¤í¬ë¦½íŠ¸ ë¸”ë¡ì´ í•„ìš” ì—†ìŠµë‹ˆë‹¤.
   ë§Œì•½ ì´ í˜ì´ì§€ì—ì„œë§Œ í•„ìš”í•œ ì¶”ê°€ JSê°€ ìˆë‹¤ë©´ ì—¬ê¸°ì— ì‘ì„±í•©ë‹ˆë‹¤. #}
{% endblock %}