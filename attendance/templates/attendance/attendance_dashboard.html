{% extends 'base.html' %}
{% load static %}

{% block title %}{{ user.username }}ë‹˜ì˜ ì¶œì„ë¶€{% endblock %}

{% block extra_head %}
{# ë§Œì•½ ì´ í˜ì´ì§€ì—ì„œë§Œ í•„ìš”í•œ ì¶”ê°€ CSSë‚˜ JSê°€ ìˆë‹¤ë©´ ì—¬ê¸°ì— ë„£ìŠµë‹ˆë‹¤. #}
{# ë³´ë‚´ì£¼ì‹  CSSê°€ ì´ë¯¸ base.htmlì´ë‚˜ ê³µí†µ CSSì— í¬í•¨ë˜ì–´ ìˆë‹¤ë©´ ë³„ë„ ë§í¬ëŠ” í•„ìš” ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. #}
{# <link rel="stylesheet" href="{% static 'css/your_main_site_styles.css' %}"> #}
<style>
    /* ì¶”ê°€ì ìœ¼ë¡œ ì´ í˜ì´ì§€ë§Œì„ ìœ„í•œ ì•„ì£¼ ì•½ê°„ì˜ CSS ì¡°ì •ì´ í•„ìš”í•˜ë‹¤ë©´ ì—¬ê¸°ì— ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. */
    /* ì˜ˆë¥¼ ë“¤ì–´, ë‹¬ë ¥ ë‚´ í™œë™ ê¸°ë¡ í…ìŠ¤íŠ¸ì˜ ì„¸ë¶€ ìŠ¤íƒ€ì¼ ë“± */
    .calendar-day .activity-info {
        font-size: 0.7em;
        margin-top: 4px;
        color: #007bff; /* ì˜ˆì‹œ ìƒ‰ìƒ */
        line-height: 1.1;
    }
    .calendar-day .activity-info i {
        margin-right: 2px;
    }
    /* ì˜¤ëŠ˜ ë‚ ì§œì— ëŒ€í•œ íŠ¹ë³„í•œ ê°•ì¡° (ê¸°ì¡´ CSSì— today ìŠ¤íƒ€ì¼ì´ ì—†ë‹¤ë©´) */
    .calendar-day.today {
        border: 2px solid #ffc107; /* ì˜ˆì‹œ: ë…¸ë€ìƒ‰ í…Œë‘ë¦¬ */
        background-color: #fff9e6; /* ì˜ˆì‹œ: ì—°í•œ ë…¸ë€ìƒ‰ ë°°ê²½ */
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard"> {# ì „ì²´ ëŒ€ì‹œë³´ë“œ ì»¨í…Œì´ë„ˆ (ê¸°ì¡´ CSSì˜ .dashboard í´ë˜ìŠ¤ í™œìš©) #}

    {# í˜ì´ì§€ ì œëª© - ê¸°ì¡´ CSSì˜ .calendar-title ë˜ëŠ” .page-title-decorated ë“±ì„ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. #}
    {# ì—¬ê¸°ì„œëŠ” .calendar-titleì„ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •í•˜ê² ìŠµë‹ˆë‹¤. #}
    <div class="header" style="margin-bottom: 1.5em;"> {# ê°„ë‹¨í•œ í—¤ë” #}
        <h2 class="calendar-title" style="text-align:center; width:100%;">ğŸ“… {{ current_year_display }}ë…„ {{ current_month_display }} ì¶œì„ë¶€</h2>
    </div>
    
    <div class="attendance-summary text-center mb-4"> {# ìš”ì•½ ì •ë³´ - ê¸°ì¡´ CSSì˜ ìŠ¤íƒ€ì¼ì„ ë”°ë¥´ë„ë¡ í´ë˜ìŠ¤ ë¶€ì—¬ ê°€ëŠ¥ #}
        <p>{{ user.username }}ë‹˜, ì˜¤ëŠ˜ ({{ today.month }}ì›” {{ today.day }}ì¼)
            {% if is_attended_today %}
                <span style="color: green; font-weight: bold;">âœ… ì¶œì„ ì™„ë£Œ!</span>
            {% else %}
                <span style="color: red; font-weight: bold;">âŒ ë¯¸ì¶œì„</span>
                <form method="post" action="{% url 'attendance:record_attendance' %}" style="display: inline-block; margin-left: 10px;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-success py-1 px-2" style="font-size:0.85rem;">ì§€ê¸ˆ ì¶œì„</button>
                </form>
            {% endif %}
        </p>
        <p>í˜„ì¬ ì—°ì† ì¶œì„: <strong style="color:#4CAF50;">{{ consecutive_days }}ì¼</strong> | ìµœì¥ ì—°ì† ì¶œì„: <strong style="color:#4CAF50;">{{ longest_streak }}ì¼</strong></p>
    </div>

    {# ë‹¬ë ¥ ì˜ì—­ - ê¸°ì¡´ CSSì˜ .calendar-box ì™€ .calendar-grid í™œìš© #}
    <div class="calendar-box">
        {# ë‹¬ë ¥ ìš”ì¼ í—¤ë” - ê¸°ì¡´ CSSì— .calendar-day-name ê°™ì€ í´ë˜ìŠ¤ê°€ ìˆë‹¤ë©´ í™œìš© #}
        <div class="calendar-grid" style="padding-bottom: 10px; border-bottom: 1px solid #eee; margin-bottom:5px;">
            {% for day_header in "ì›”í™”ìˆ˜ëª©ê¸ˆí† ì¼"|make_list %}
            <div class="calendar-day calendar-day-name"><strong>{{ day_header }}</strong></div>
            {% endfor %}
        </div>

        {# ë‹¬ë ¥ ë‚ ì§œ ë¶€ë¶„ #}
        <div class="calendar-grid">
            {% for week_data in calendar_weeks_data %}
                {% for day_cell in week_data %}
                <div class="calendar-day 
                            {% if day_cell.day_num == today.day and current_month_int == today.month and current_year_display == today.year %}today{% endif %}
                            {% if day_cell.is_attended %}attended{% endif %}
                            {% if not day_cell.day_num %}calendar-empty{% endif %}"
                     {% if day_cell.day_num %}
                         data-day="{{ day_cell.day_num }}"
                         data-month="{{ current_month_int }}"
                         data-year="{{ current_year_display }}"
                         data-attended="{% if day_cell.is_attended %}ì¶œì„{% else %}ë¯¸ì¶œì„{% endif %}"
                         data-problems="{{ day_cell.activities.problems_solved|default:0 }}"
                         style="cursor: pointer;"
                     {% endif %}
                >
                    {% if day_cell.day_num %}
                        <span class="day-number">{{ day_cell.day_num }}</span>
                        
                        {% if day_cell.is_attended and not day_cell.activities.problems_solved %} 
                            {# ì¶œì„ë§Œ í•˜ê³  ë‹¤ë¥¸ í™œë™ì´ ì—†ë‹¤ë©´ ê°„ë‹¨íˆ í‘œì‹œ #}
                            {# (ìœ„ CSSì—ì„œ .calendar-day.attended::after ë¡œ â˜€ï¸ í‘œì‹œ ì˜ˆì‹œ) #}
                        {% endif %}

                        {% if day_cell.activities.problems_solved > 0 %}
                        <div class="activity-info">
                            {# <i class="fas fa-pencil-alt"></i> #} í€´ì¦ˆ: {{ day_cell.activities.problems_solved }}
                        </div>
                        {% endif %}
                        {# ì—¬ê¸°ì— ë‹¤ë¥¸ í™œë™ ê¸°ë¡(ì˜ˆ: í¬ì¸íŠ¸ íšë“)ì„ ìœ„í•œ div ì¶”ê°€ ê°€ëŠ¥ #}
                    {% endif %}
                </div>
                {% endfor %}
            {% endfor %}
        </div>
    </div>
    
    {# ì¶”ê°€ì ì¸ í•™ìŠµ ë¦¬í¬íŠ¸/í†µê³„ ì˜ì—­ì´ í•„ìš”í•˜ë‹¤ë©´ ê¸°ì¡´ CSSì˜ .learn-chart-box ë“±ì„ í™œìš© #}


</div> {# End of .dashboard #}

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.calendar-grid .calendar-day[data-day]').forEach(cell => {
        cell.addEventListener('click', function() {
            const day = this.getAttribute('data-day');
            if (!day) return;

            const month = this.getAttribute('data-month');
            const year = this.getAttribute('data-year');
            const attended = this.getAttribute('data-attended');
            const problems = this.getAttribute('data-problems');

            let details = `${year}ë…„ ${month}ì›” ${day}ì¼ í™œë™:\n`;
            details += `ì¶œì„: ${attended}\n`;
            if (parseInt(problems) > 0) {
                details += `í‘¼ ë¬¸ì œ ìˆ˜: ${problems}ê°œ`;
            }
            
            if (attended === 'ë¯¸ì¶œì„' && parseInt(problems) == 0) {
                // íŠ¹ë³„í•œ í™œë™ì´ ì—†ìœ¼ë©´ êµ³ì´ alertë¥¼ ë„ìš°ì§€ ì•Šê±°ë‚˜ ë‹¤ë¥¸ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                // alert(`${year}ë…„ ${month}ì›” ${day}ì¼\nê¸°ë¡ëœ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤.`);
            } else {
                alert(details); // ì‹¤ì œë¡œëŠ” ë” ì˜ˆìœ UI(ëª¨ë‹¬, íˆ´íŒ)ë¡œ ëŒ€ì²´ ê¶Œì¥
            }
        });
    });
});
</script>
{% endblock %}